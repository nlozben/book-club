<!DOCTYPE html>
<script>
let eventSource;

function start() { // when "Start" button pressed
  if (!window.EventSource) {
    // IE or an old browser
    alert("The browser doesn't support EventSource.");
    return;
  }

  eventSource = new EventSource('http://localhost:8080/populate_dialer', {
    withCredentials: true,
  });

  eventSource.onopen = function(e) {
    log("Event: open");
  };

  eventSource.onerror = function(e) {
    log("Event: error");
    if (this.readyState == EventSource.CONNECTING) {
      log(`Reconnecting (readyState=${this.readyState})...`);
    } else {
      log("Error has occured.");
    }
  };

  eventSource.addEventListener('bye', function(e) {
    log("Event: bye, data: " + e.data);
  });

  eventSource.onmessage = function(e) {
    log("Event: message, data: " + e.data);
  };
}

function stop() { // when "Stop" button pressed
  eventSource.close();
  log("eventSource.close()");
}

function log(msg) {
  logElem.innerHTML += msg + "<br>";
  document.documentElement.scrollTop = 99999999;
}

function send() {
  fetch('http://localhost:3000/customer', {
    method: "POST",
    body: JSON.stringify({
      name: document.getElementById('name').value,
      phoneNumber: document.getElementById('phoneNumber').value,
    }),
    headers: {
      "Content-type": "application/json; charset=UTF-8"
    }
  });
}

</script>

<div id="logElem" style="margin: 6px 0"></div>
<h1>HCP web application (sender)</h1>
Name: <input type="text" id="name" name="name" /> <br />
Phone Number: <input type="text" id="phoneNumber" name="phoneNumber" /> <br />
<button onclick="send()">send</button>
